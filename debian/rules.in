#!/usr/bin/make -f
export DEB_CXXFLAGS_MAINT_APPEND=-O3 -Wall -Wextra

# Workaround for unversioned SONAMEs in EMANE shared libraries
override_dh_makeshlibs:
	dh_listpackages | xargs -I {} dpkg-gensymbols -Pdebian/{} -p{} -q

override_dh_auto_configure:
	dh_auto_configure -- PYTHON=@PYTHON@

ifeq (@PYTHON_MAJOR_VERSION@,3)

PYTHON_DEPENDS = -Vpython:Depends="python3:any (>= 3.0), python3, python3-pkg-resources, python3-protobuf, python3-lxml"
PYTHON_LXML_DEPENDS = -Vpython-lxml:Depends="python3:any (>= 3.0), python3, python3-lxml"

else

PYTHON_DEPENDS = -Vpython:Depends="python:any (<< 2.8), python:any (>= 2.7), python, python-pkg-resources, python-protobuf, python-lxml"
PYTHON_LXML_DEPENDS = -Vpython-lxml:Depends="python:any (<< 2.8), python:any (>= 2.7), python, python-lxml"

endif

override_dh_gencontrol:
	dh_gencontrol -- $(PYTHON_DEPENDS) $(PYTHON_LXML_DEPENDS)

%:
	dh $@ --parallel --with autotools-dev --with python@PYTHON_MAJOR_VERSION@

